<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Estatísticas | Rokuzen</title>
    <meta name="description" content="Estatísticas do rokuzen." />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <link rel="shortcut icon" href="../assets/Logo/favicon-rokuzen.png" type="image/x-icon" />
    <link rel="stylesheet" href="../CSS/global.css" />
    <link rel="stylesheet" href="../CSS/unidades.css" />
</head>

<body class="estatisticas-page">
    <header>
        <nav>
            <section class="parte-de-cima">
                <section class="logo">
                    <a href="index.html"><img src="../assets/Logo/logo-rokuzen.png" alt="Logo Rokuzen" /></a>
                </section>

                <a href="autenticacao.html"><i class="bi bi-person"></i></a>

                <ul class="menu-desktop">
                    <li><a href="servicos.html">Serviços</a></li>
                    <li><a href="unidades.html" class="active">Unidades</a></li>
                    <li><a href="artigos.html">Artigos</a></li>
                    <li><a href="profissionais.html">Profissionais</a></li>
                    <li><a href="ajuda.html">Ajuda</a></li>
                    <li><a href="sobre-nos.html">Sobre nós</a></li>
                </ul>
            </section>

            <section class="parte-do-meio">
                <section class="login-btn">
                    <a href="autenticacao.html"><i class="bi bi-person"></i></a>
                </section>

                <section class="menu-btn">
                    <i class="bi bi-list" onclick="menuToggle()"></i>
                </section>

                <ul>
                    <li class="close-btn-li"><i class="bi bi-x close-btn" onclick="menuToggle()"></i></li>
                    <li><a href="servicos.html">Serviços</a></li>
                    <li><a href="unidades.html" class="active">Unidades</a></li>
                    <li><a href="artigos.html">Artigos</a></li>
                    <li><a href="profissionais.html">Profissionais</a></li>
                    <li><a href="ajuda.html">Ajuda</a></li>
                    <li><a href="sobre-nos.html">Sobre nós</a></li>
                </ul>
            </section>

            <section class="parte-de-baixo">
                <section class="barra-de-pesquisa">
                    <input type="text" placeholder="Pesquisar" aria-label="Pesquisar" />
                    <i class="bi bi-search"></i>
                </section>
            </section>
        </nav>
    </header>

    <section class="banner-unidades">
        <h1>ESTATÍSTICAS</h1>
        <img src="../assets/Logo/logo-titulos.png" alt="Marca Rokuzen" />
    </section>

   <div class="graficos-container">
    <div class="grafico-box">
        <canvas id="graficoServicos"></canvas>
    </div>
    <div class="grafico-box">
        <canvas id="graficoUnidades"></canvas>
    </div>
    <div class="grafico-box">
        <canvas id="graficoMensal"></canvas>
    </div>
    <div class="grafico-box">
        <canvas id="graficoProfissionais"></canvas>
    </div>
</div>

    <footer class="roda-pe">
        <section class="info-rokuzen">
            <p><a href="#">Contato</a></p>
            <p><a href="unidades.html" class="active">Unidade</a></p>
            <p><a href="sobre-nos.html">Sobre nós</a></p>
        </section>

        <section class="redes-sociais">
            <button><a href="https://www.instagram.com/rokuzen.massagem" target="_blank" rel="external"><i
                        class="bi bi-instagram"></i></a></button>
            <button><a href="https://www.facebook.com/rokuzen.massagem" target="_blank" rel="external"><i
                        class="bi bi-facebook"></i></a></button>
            <button><a href="mailto:contato@rokuzen.com.br" target="_blank" rel="noopener noreferrer"><i
                        class="bi bi-envelope"></i></a></button>
        </section>

        <section class="direito-de-imagem">
            <p><i class="bi bi-c-circle"></i> 2025 Rokuzen - Todos os direitos reservados.</p>
        </section>
    </footer>

    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script> new window.VLibras.Widget('https://vlibras.gov.br/app'); </script>
    <script src="../JS/menu-home-page.js"></script>
    <script>
function gerarGrafico(endpoint, canvasId, labelDataset, titulo, tipo = "bar", backgroundColor = 'rgba(168, 190, 124, 0.8)', labelField = 'nome') {
    fetch(endpoint)
        .then(res => res.json())
        .then(data => {
            const labels = data.map(item => item[labelField]);
            const totals = data.map(item => item.total);

            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: tipo,
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelDataset,
                        data: totals,
                        backgroundColor: backgroundColor,
                        borderColor: 'rgba(128, 128, 128, 0.822)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: titulo,
                            font: { size: 18, weight: 'bold' },
                            color: '#333'
                        },
                        legend: { display: true, position: 'top' }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
        })
        .catch(err => console.error('Erro ao gerar gráfico:', err));
}

gerarGrafico(
  'http://localhost:3000/agendamentos_servicos_ultimo_mes', 
  'graficoServicos',                                  
  'Agendamentos por serviço',                           
  'Agendamentos por Serviço no Último Mês',              
  'bar',                                                    
  'rgba(168, 190, 124, 0.8)',                               
  'nome_servico'                                           
);
gerarGrafico(
    'http://localhost:3000/agendamentos_unidades_ultimo_mes',
    'graficoUnidades',
    'Agendamentos por Unidade',
    'Agendamentos por Unidade no Último Mês',
    'pie',
    [
        'rgba(168, 190, 124, 0.8)',
        'rgba(255, 99, 132, 0.8)',
        'rgba(54, 162, 235, 0.8)',
        'rgba(255, 206, 86, 0.8)'
    ],
    'nome_unidade' 
);
gerarGrafico('http://localhost:3000/agendamentos_profissionais', 'graficoProfissionais', 'Agendamentos por profissional', 'Agendamentos por Profissional (Total)', "bar", 'rgba(168, 190, 124, 0.8)', 'nome_colaborador');

gerarGrafico('http://localhost:3000/agendamentos_ultimo_ano', 'graficoMensal', 'Agendamentos por mês', 'Agendamentos no Último Ano', "line", 'rgba(168, 190, 124, 0.8)', 'mes');

</script>
</body>

</html>